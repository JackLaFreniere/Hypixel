<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corpse ROI Calculator</title>
    <meta name="description" content="Calculate the return on investment for different corpse types in Hypixel Skyblock Glacite Tunnels">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #e2e8f0;
            background: #0f172a;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            border-bottom: 1px solid #334155;
        }
        .header h1 {
            font-size: 2.5em;
            font-weight: 300;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
            color: #94a3b8;
        }
        
        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        /* Corpse Selection */
        .corpse-selection {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .corpse-selection h2 {
            color: #f1f5f9;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .corpse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .corpse-option {
            background: #334155;
            border: 2px solid #475569;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .corpse-option:hover {
            border-color: #60a5fa;
            transform: translateY(-2px);
        }
        
        .corpse-option.selected {
            border-color: #10b981;
            background: #065f46;
        }
        
        .corpse-image {
            width: 64px;
            height: 64px;
            margin: 0 auto 15px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        .corpse-option h3 {
            color: #f1f5f9;
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        .corpse-option p {
            color: #94a3b8;
            font-size: 0.9em;
        }
        
        /* Controls */
        .controls {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .controls h2 {
            color: #f1f5f9;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        
        /* Results */
        .results {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .results h2 {
            color: #f1f5f9;
            margin-bottom: 25px;
            font-size: 1.5em;
            text-align: center;
        }
        
        .results-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        
        .roi-summary {
            background: #334155;
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 25px;
        }
        
        .roi-summary h3 {
            color: #f1f5f9;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
            border-bottom: 1px solid #475569;
            padding-bottom: 10px;
        }
        
        .roi-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px 0;
        }
        
        .roi-item:not(:last-child) {
            border-bottom: 1px solid #475569;
        }
        
        .roi-label {
            color: #94a3b8;
            font-weight: 500;
        }
        
        .roi-value {
            color: #f1f5f9;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .roi-value.positive {
            color: #10b981;
        }
        
        .roi-value.negative {
            color: #ef4444;
        }
        
        .profit-indicator {
            background: #334155;
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        
        .profit-indicator h3 {
            color: #f1f5f9;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .profit-amount {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .profit-percentage {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .profit-status {
            font-size: 1.1em;
            font-weight: 500;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .profit-status.profitable {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }
        
        .profit-status.unprofitable {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }
        
        /* Drop Table */
        .drop-table {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .drop-table h2 {
            color: #f1f5f9;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #334155;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: #334155;
        }
        
        th, td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #475569;
        }
        
        th {
            background: #1e293b;
            color: #f1f5f9;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td {
            color: #e2e8f0;
        }
        
        tr:hover {
            background: #475569;
        }
        
        .item-price {
            font-weight: 600;
        }
        
        .positive-value {
            color: #10b981;
        }
        
        .negative-value {
            color: #ef4444;
        }
        
        .sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        
        .sortable:hover {
            background: #334155;
        }
        
        .sortable::after {
            content: ' ↕';
            opacity: 0.5;
        }
        
        .sort-asc::after {
            content: ' ↑';
            opacity: 1;
        }
        
        .sort-desc::after {
            content: ' ↓';
            opacity: 1;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
        }
        
        .spinner {
            border: 3px solid #334155;
            border-top: 3px solid #60a5fa;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Status Messages */
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            color: #10b981;
        }
        
        .status.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            color: #ef4444;
        }
        
        .status.warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid #f59e0b;
            color: #f59e0b;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 20px 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
            }
            
            .corpse-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏺 Corpse ROI Calculator</h1>
        <p>Calculate the return on investment for different corpse types in Hypixel Skyblock</p>
    </div>

    <div class="container">
        <!-- Corpse Selection -->
        <div class="corpse-selection">
            <h2>Select Corpse Type</h2>
            <div class="corpse-grid">
                <div class="corpse-option" data-corpse="vanguard">
                    <div class="corpse-image" style="background-image: url('../assets/Images/Corpses/SkyBlock_entities_corpse_vanguard.png');"></div>
                    <h3>Vanguard Corpse</h3>
                    <p>Opened with Skeleton Key</p>
                </div>
                <div class="corpse-option" data-corpse="tungsten">
                    <div class="corpse-image" style="background-image: url('../assets/Images/Corpses/SkyBlock_entities_corpse_tungsten.png');"></div>
                    <h3>Tungsten Corpse</h3>
                    <p>Opened with Tungsten Key</p>
                </div>
                <div class="corpse-option" data-corpse="umber">
                    <div class="corpse-image" style="background-image: url('../assets/Images/Corpses/SkyBlock_entities_corpse_umber.png');"></div>
                    <h3>Umber Corpse</h3>
                    <p>Opened with Umber Key</p>
                </div>
                <div class="corpse-option" data-corpse="lapis">
                    <div class="corpse-image" style="background-image: url('../assets/Images/Corpses/SkyBlock_entities_corpse_lapis.png');"></div>
                    <h3>Lapis Corpse</h3>
                    <p>Opened with Lapis Key</p>
                </div>
            </div>

        </div>

        <!-- Results -->
        <div class="results" id="results" style="display: none;">
            <h2>ROI Analysis</h2>
            <div class="results-container">
                <div class="profit-indicator">
                    <h3>� Profitability</h3>
                    <div class="profit-amount" id="profitAmount">+0</div>
                    <div class="profit-percentage" id="profitPercentage">0%</div>
                    <div class="profit-status" id="profitStatus">Select a corpse to calculate</div>
                </div>
                
                <div class="roi-summary">
                    <h3>📊 Cost Breakdown</h3>
                    <div class="roi-item">
                        <span class="roi-label">Key Cost:</span>
                        <span class="roi-value" id="keyCostDisplay">0</span>
                    </div>
                    <div class="roi-item">
                        <span class="roi-label">Expected Revenue:</span>
                        <span class="roi-value" id="avgRevenueDisplay">0</span>
                    </div>
                    <div class="roi-item">
                        <span class="roi-label">Expected Profit:</span>
                        <span class="roi-value" id="expectedProfitDisplay">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Drop Table -->
        <div class="drop-table">
            <h2 id="dropTableTitle">Drop Table - Select a Corpse</h2>
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading prices...</p>
            </div>
            <div id="dropTableContainer" style="display: none;">
                <div class="table-container">
                    <table id="dropTable">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="item">Item</th>
                                <th class="sortable" data-sort="quantity">Quantity</th>
                                <th class="sortable" data-sort="weight">Weight (Points)</th>
                                <th class="sortable" data-sort="weightPercent">Weight (%)</th>
                                <th class="sortable" data-sort="price">Price Each</th>
                                <th class="sortable" data-sort="total">Total Value</th>
                                <th class="sortable" data-sort="weighted">Expected Per Corpse</th>
                            </tr>
                        </thead>
                        <tbody id="dropTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Messages -->
    <div id="statusContainer"></div>

    <!-- Scripts -->
    <script src="../js/apis/hypixel-bazaar-api.js" 
            onerror="console.error('Failed to load hypixel-bazaar-api.js'); document.body.innerHTML += '<div style=\'background:red;color:white;padding:10px;\'>ERROR: Could not load hypixel-bazaar-api.js from ../js/apis/</div>'"></script>
    <script src="../js/apis/coflnet-auction-api.js" 
            onerror="console.error('Failed to load coflnet-auction-api.js'); document.body.innerHTML += '<div style=\'background:red;color:white;padding:10px;\'>ERROR: Could not load coflnet-auction-api.js from ../js/apis/</div>'"></script>
    <script src="../js/corpse-roi-calculator.js" 
            onerror="console.error('Failed to load corpse-roi-calculator.js'); document.body.innerHTML += '<div style=\'background:red;color:white;padding:10px;\'>ERROR: Could not load corpse-roi-calculator.js from ../js/</div>'"></script>
    <script>
        // Wait for all scripts to load
        window.addEventListener('load', function() {
            console.log('Page fully loaded, starting initialization...');
            
            // Check if all required classes are available
            console.log('Checking required classes...');
            console.log('HypixelBazaarAPI:', typeof HypixelBazaarAPI);
            console.log('CoflnetAuctionAPI:', typeof CoflnetAuctionAPI);
            console.log('CorpseROICalculator:', typeof CorpseROICalculator);
            
            if (typeof HypixelBazaarAPI === 'undefined') {
                console.error('HypixelBazaarAPI is not loaded!');
                document.body.innerHTML += '<div style="background: red; color: white; padding: 10px;">ERROR: HypixelBazaarAPI failed to load. Check file path.</div>';
                return;
            }
            
            if (typeof CoflnetAuctionAPI === 'undefined') {
                console.error('CoflnetAuctionAPI is not loaded!');
                document.body.innerHTML += '<div style="background: red; color: white; padding: 10px;">ERROR: CoflnetAuctionAPI failed to load. Check file path.</div>';
                return;
            }
            
            if (typeof CorpseROICalculator === 'undefined') {
                console.error('CorpseROICalculator is not loaded!');
                document.body.innerHTML += '<div style="background: red; color: white; padding: 10px;">ERROR: CorpseROICalculator failed to load. Check file path.</div>';
                return;
            }
            
            initializeCalculator();
        });
        
        function initializeCalculator() {
            console.log('Starting calculator initialization...');
            
            // Initialize global APIs first
            try {
                window.globalBazaarAPI = new HypixelBazaarAPI();
                window.globalCoflnetAPI = new CoflnetAuctionAPI();
                console.log('Global APIs created successfully');
            } catch (error) {
                console.error('Error creating global APIs:', error);
                return;
            }
            
            // Initialize the calculator
            try {
                window.calculator = new CorpseROICalculator();
                console.log('Calculator created successfully');
            } catch (error) {
                console.error('Error creating calculator:', error);
                return;
            }
            
            // Initialize the APIs
            console.log('Initializing APIs...');
            window.globalBazaarAPI.initialize().then(() => {
                console.log('Bazaar API initialized successfully');
                // Load loot tables after API is ready
                window.calculator.loadLootTables();
            }).catch(error => {
                console.error('Failed to initialize Bazaar API:', error);
            });
            
            // Set up corpse selection with better error handling
            const corpseOptions = document.querySelectorAll('.corpse-option');
            console.log('Found corpse options:', corpseOptions.length);
            
            corpseOptions.forEach((option, index) => {
                console.log(`Setting up event listener for corpse option ${index + 1}:`, option.dataset.corpse);
                
                option.addEventListener('click', async () => {
                    try {
                        console.log('=== CORPSE CLICKED ===');
                        console.log('Corpse clicked:', option.dataset.corpse);
                        
                        // Remove selected class from all options
                        document.querySelectorAll('.corpse-option').forEach(opt => opt.classList.remove('selected'));
                        // Add selected class to clicked option
                        option.classList.add('selected');
                        console.log('Visual selection updated');
                        
                        // Set the corpse type (now async)
                        const corpseType = option.dataset.corpse;
                        console.log('About to call setCorpseType with:', corpseType);
                        
                        if (window.calculator && window.calculator.setCorpseType) {
                            await window.calculator.setCorpseType(corpseType);
                            console.log('setCorpseType completed');
                        } else {
                            console.error('Calculator or setCorpseType method not available');
                        }
                    } catch (error) {
                        console.error('Error in corpse click handler:', error);
                        if (window.calculator && window.calculator.showStatus) {
                            window.calculator.showStatus('Error selecting corpse. Please try again.', 'error');
                        }
                    }
                });
            });
            
            console.log('Event listeners set up. Calculator ready!');
        }
        
        // Set up table sorting
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('sortable')) {
                const sortBy = e.target.dataset.sort;
                if (window.calculator) {
                    window.calculator.sortTable(sortBy);
                }
            }
        });
    </script>
</body>
</html>